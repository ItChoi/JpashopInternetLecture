## 변경 감지와 병합
- 정~~~~말 중요한 개념!!!!!!
- 변경 감지와 병합의 차이를 알아야 한다.
- 준영속 엔티티의 이해부터 필요하다.
  - 엔티티 영속 관리 -> 변경만 해주면 JPA가 알아서 update (더티 체킹 = 병경 감지)
  - 준영속 엔티티일 때는?
    - 준영속: 실제로 DB에 갔다온 엔티티를 구분할 수 있는 상태 (식별자)
    - 영속성 컨텍스트가 더이상 관리 안한다.
    - 문제가 뭐냐면, JPA가 관리를 안한다. 
      - JPA 관리 엔티티는 변경 감지가 일어난다.
      - 그래서 new로 제어... 따라서 값을 변경해도 DB 업데이트가 안일어다. 
      - 준영속 상태는 DB 수정 하는 방법
        1. 준영속 엔티티지만 변경 감지 이용 하는 방법 (권장 방법)
          - 영속 상태를 가져온 다음, 준영속에 있는 데이터를 영속 상태 엔티티에 넣어준다.
        2. 병합(merge) 사용
          - 준영속 엔티티를 영속 상태로 변경할 떄 사용하는 기능!-
          - em.merge(entity) 
            - merge는 단순하게 말하자면, 영속 상태의 데이터를 찾고, 준영속 상태에 데이터를 다 바꿔준다.
              - 그러나 권장 방법과는 차이가 있다. 
                - merge 호출 -> 파라미터 넘어온 식별자로 영속성 컨텍스트에서 찾고 없으면 DB 조회 하고 mergeEntity에 파라미터로 넘어온 데이터를 쫘악 밀어 넣는다. 바꿔치기 된 엔티티를 반환해준다. 
- 병합 주의점!!!
  - 변경 감지 기능 사용 시 원하는 속성을 선택해서 변경 가능하지만, merge는 파라미터로 넘어온 것으로 다 set 된다. 즉, null로 넘어온 값도 set이 될 수 있다. 
  - 따라서 merge보다 변경 감지를 사용하자!!!!!!!!!!!!!!!!!!!
  - 권장 방법도 의미있는 값을 넣어주는 메서드를 사용하자. set 도배 하지말자!
- 컨트롤러에서 어설프게 엔티티를 쓰지 마세요!!!!
  - DTO 데이터를 가져와서 service에 Entity를 넘겨줬는데, 더 나은 방법은 service.updateEntity(id, 필요 변수1, 필요 변수2, 필요변수 3) 이 방식이 더 좋다. 필요 변수가 많은 경우 DTO를 만들자. DTO로 넘겨서 풀어도 된다.
    - 서비스 계층에 식별자(id)와 변경할 데이터를 명확하게 전달!!!
    - Transaction 안에서 조회해야 영속상태!! 거기서 변경해야 변경 감지가 일어난다!!!!!!!!!!!
  